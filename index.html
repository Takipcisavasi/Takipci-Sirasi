<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Takipçi Savaşı</title>

  <!-- FAVICON / PREVIEW (assets klasörü) -->
  <link rel="icon" href="/assets/favicon-32.png" sizes="32x32">
  <link rel="icon" href="/assets/favicon-192.png" sizes="192x192">
  <link rel="apple-touch-icon" href="/assets/apple-touch-icon.png">
  <meta name="theme-color" content="#0b0b12">
  <meta property="og:title" content="Takipçi Savaşı">
  <meta property="og:description" content="Top 100 ve sıralama arama">
  <meta property="og:image" content="/assets/og-image.png">
  <meta property="og:type" content="website">
  <meta name="twitter:card" content="summary_large_image">

  <style>
    :root{
      --bg:#0b0b12; --card:#141422; --muted:#aaa; --text:#eee; --border:#26263a;
      --accent:#7e86ff; --chip:#1d1d2b; --chip-b:#32324a; --hl:#11301f; --hl-b:#2ac97f;
    }
    *{box-sizing:border-box}
    html,body{margin:0;background:var(--bg);color:var(--text);font:14px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
    .wrap{max-width:1100px;margin:0 auto;padding:16px}
    header{display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin-bottom:12px}
    h1{margin:0;font-size:22px}
    .chip{background:var(--chip);border:1px solid var(--chip-b);padding:6px 10px;border-radius:999px;font-size:12px}
    .btn{background:var(--accent);border:0;color:#fff;padding:10px 14px;border-radius:10px;cursor:pointer}
    .btn:active{transform:translateY(1px)}
    input,select{background:#10101a;color:var(--text);border:1px solid #2b2b3c;border-radius:10px;padding:10px 12px}
    .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .grow{flex:1}
    .card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:14px}
    .grid{display:grid;grid-template-columns:2fr 1fr;gap:12px}
    @media (max-width:900px){.grid{grid-template-columns:1fr}}
    table{width:100%;border-collapse:collapse}
    th,td{padding:10px;border-bottom:1px solid #1c1c2b}
    th{color:var(--muted);text-align:left}
    .muted{color:var(--muted)}
    .hl{background:var(--hl)!important;border-left:3px solid var(--hl-b)}
    .error{margin-top:8px;color:#ff9e9e;background:#3b1212;border:1px solid #5a1b1b;padding:10px;border-radius:10px;white-space:pre-wrap}

    /* --- LOGO --- */
    .brand{display:flex;align-items:center;gap:10px}
    .logo{height:28px; width:auto; display:block; border-radius:6px}
    .brand-title{display:flex;align-items:center;gap:8px}
    .brand-sep{width:1px;height:20px;background:#2b2b3c;border-radius:1px}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <!-- LOGO + BAŞLIK (assets) -->
      <div class="brand">
        <!-- Önce SVG dener, 404 olursa PNG'ye düşer -->
        <img class="logo" src="/assets/logo.svg" alt="Takipçi Savaşı"
             onerror="this.onerror=null;this.src='/assets/logo.png'">
        <div class="brand-title">
          <h1>Takipçi Savaşı</h1>
          <span class="brand-sep"></span>
          <span class="chip">Toplam <b id="total">0</b> kişi</span>
        </div>
      </div>

      <div class="grow"></div>
      <a class="chip" href="https://instagram.com/takipcisavasi" target="_blank" rel="noopener">instagram.com/takipcisavasi</a>
    </header>

    <div class="row" style="margin-bottom:12px">
      <input id="q" placeholder="@kullanıcı bul" class="grow" />
      <button id="btnFind" class="btn">Sırayı Göster</button>
      <div class="row" style="margin-left:auto">
        <label class="muted">Sayfa:</label>
        <select id="page"></select>
        <button id="btnPage" class="btn" style="background:#23233b">Görüntüle</button>
      </div>
    </div>

    <div class="grid">
      <section class="card">
        <div class="row" style="margin-bottom:8px"><strong>Top 100</strong></div>
        <table id="tbl">
          <thead>
          <tr><th style="width:56px">#</th><th>Kullanıcı</th><th class="muted" style="width:130px">Not</th></tr>
          </thead>
          <tbody><tr><td colspan="3" class="muted" id="loading">Yükleniyor…</td></tr></tbody>
        </table>
        <div id="err" class="error" style="display:none"></div>
      </section>

      <aside class="card">
        <div class="row" style="margin-bottom:8px"><strong>İlk 5</strong></div>
        <div id="top5"></div>
      </aside>
    </div>
  </div>

<script>
/* -------- helpers -------- */
const PAGE_SIZE = 100;

function cleanUser(line){
  if (!line) return '';
  line = line.replace(/^\uFEFF/, '');
  const parts = line.trim().split(/\s+/);
  const last = parts[parts.length-1] || '';
  return last.replace(/^@/,'').toLowerCase();
}
function parseCSV(raw){
  return raw.split(/\r?\n/).map(s=>cleanUser(s)).filter(Boolean);
}
function showError(msg){
  const el = document.getElementById('err');
  el.textContent = msg;
  el.style.display = 'block';
}
function setLoading(on){
  const td = document.getElementById('loading');
  if (!td) return;
  td.style.display = on ? 'table-cell' : 'none';
}

/* -------- renderers -------- */
let LIST = [];
let INDEX = new Map();
function fillPageSelect(total){
  const pages = Math.max(1, Math.ceil(total / PAGE_SIZE));
  const sel = document.getElementById('page');
  sel.innerHTML = '';
  for (let i=1;i<=pages;i++){
    const opt = document.createElement('option');
    opt.value = String(i);
    opt.textContent = String(i);
    sel.appendChild(opt);
  }
}
function renderTop5(){
  const c = document.getElementById('top5');
  c.innerHTML = '';
  const top = LIST.slice(0,5);
  top.forEach((u,i)=>{
    const div = document.createElement('div');
    div.style.cssText='display:flex;align-items:center;gap:10px;margin-bottom:8px;background:#11111b;border:1px solid #26263a;padding:10px;border-radius:12px';
    const dot = document.createElement('div');
    dot.style.cssText='width:26px;height:26px;border-radius:50%;display:grid;place-items:center;background:#1a1a27;border:1px solid #2b2b3c;color:#cfd0ff;font-weight:700';
    dot.textContent = String(i+1);
    const name = document.createElement('div');
    name.textContent = '@'+u;
    const cup = document.createElement('div');
    cup.textContent = i===0?'🏆':i===1?'🥈':i===2?'🥉':'';
    div.appendChild(dot); div.appendChild(name); div.appendChild(cup);
    c.appendChild(div);
  });
}
function renderTable(page=1, highlight){
  const start=(page-1)*PAGE_SIZE;
  const items=LIST.slice(start,start+PAGE_SIZE);
  const tb = document.querySelector('#tbl tbody');
  tb.innerHTML = '';
  items.forEach((u, i)=>{
    const tr=document.createElement('tr');
    const rank=start+i+1;
    const td1=document.createElement('td'); td1.textContent=rank;
    const td2=document.createElement('td'); td2.textContent='@'+u;
    const td3=document.createElement('td'); td3.className='muted'; td3.textContent='';
    tr.appendChild(td1); tr.appendChild(td2); tr.appendChild(td3);
    if (highlight && u === highlight.toLowerCase()){
      tr.classList.add('hl');
    }
    tb.appendChild(tr);
  });
}

/* -------- search/scroll -------- */
function gotoRank(rank, username){
  const page=Math.max(1,Math.ceil(rank/PAGE_SIZE));
  document.getElementById('page').value=String(page);
  renderTable(page, username);
  const idxInPage=(rank-1)%PAGE_SIZE;
  const tr=document.querySelector('#tbl tbody').children[idxInPage];
  if (tr) tr.scrollIntoView({behavior:'smooth', block:'center'});
}
function findAndShow(q){
  if(!q) return;
  const u=q.replace(/^@/,'').trim().toLowerCase();
  const pos = INDEX.get(u);
  if (pos==null){
    showError('@'+q+' bulunamadı.');
    return;
  }
  gotoRank(pos+1, u);
}

/* -------- data load -------- */
(async function init(){
  try{
    setLoading(true);
    const csvResp = await fetch('./data/followers.csv', {cache:'no-store'});
    if(!csvResp.ok){ throw new Error('followers.csv okunamadı: '+csvResp.status+' '+csvResp.statusText); }
    const csvTxt  = await csvResp.text();
    let arr = parseCSV(csvTxt);

    let bans = [];
    try{
      const bansResp = await fetch('./data/bans.json', {cache:'no-store'});
      if (bansResp.ok){ bans = await bansResp.json(); }
    }catch(_){}

    const banSet=new Set((bans||[]).map(s=>String(s).toLowerCase()));
    arr = arr.filter(u=>u && !banSet.has(u));

    LIST = arr.slice();
    INDEX.clear();
    LIST.forEach((u,i)=>INDEX.set(u,i));

    document.getElementById('total').textContent = LIST.length;

    fillPageSelect(LIST.length);
    renderTop5();
    renderTable(1);

  }catch(err){
    showError('Hata: '+ (err && err.message ? err.message : String(err)));
    console.error(err);
  }finally{
    setLoading(false);
  }
})();

/* -------- UI -------- */
document.getElementById('btnPage').onclick=()=>{ const p=parseInt(document.getElementById('page').value,10)||1; renderTable(p); };
document.getElementById('btnFind').onclick=()=>{ const q=document.getElementById('q').value; document.getElementById('err').style.display='none'; findAndShow(q); };
document.getElementById('q').addEventListener('keydown',e=>{ if(e.key==='Enter') document.getElementById('btnFind').click(); });
</script>
</body>
</html>
